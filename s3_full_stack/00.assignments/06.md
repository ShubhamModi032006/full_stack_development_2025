# Mutual Fund Portal - Simplified RBAC System

## **Technology Stack**
- **Frontend & Backend**: Next.js 14+ with App Router
- **Database**: MongoDB (Mongoose)
- **Authentication**: JWT with Next.js middleware
- **Key Focus**: Virtual SIPs & commission tracking using real NAV data
- **Stretch Goal**: Aadhaar e-KYC integration

## **User Roles (Simplified)**

### 1. **Company Head**
- Manages entire company
- Views company-wide analytics
- Manages admins and commission structure

### 2. **Admin**
- Manages sellers under them
- Team performance tracking
- Commission oversight

### 3. **Seller**
- Manages own customers
- Creates virtual SIPs
- Views personal commissions

### 4. **Customer**
- Virtual portfolio management
- Watchlist & virtual SIPs
- Personal analytics

---

## **Core Features by Role**

### **1. COMPANY HEAD**
#### **Dashboard**
- Total virtual AUM across company
- Commission analytics (charts)
- Admin/seller performance summary
- KYC status overview

#### **Management**
- Create/edit admins
- Commission slab configuration
- User activity reports
- Export reports (PDF/CSV)

### **2. ADMIN**
#### **Dashboard**
- Team AUM & commission tracking
- Seller performance rankings
- Virtual SIP creation summary
- Approval pending transactions

#### **Management**
- Create/edit sellers
- Monitor team customers (aggregated)
- Approve high-value virtual transactions
- Team reports & exports

### **3. SELLER**
#### **Dashboard**
- Personal AUM & commissions
- Customer portfolio summary
- Virtual SIP performance
- Daily transaction summary

#### **Customer Management**
- Add customers (basic KYC)
- Create virtual SIPs for customers
- View customer portfolios
- Transaction history

### **4. CUSTOMER**
#### **Portfolio**
- Virtual portfolio view
- Real-time NAV updates
- SIP management (start/pause/stop)
- Performance charts

#### **Discovery**
- Fund search & filter
- Watchlist management
- Virtual investment simulator
- Basic reports

---

## **Key Technical Requirements**

### **Database Collections**
```javascript
// Core collections
users: { role, parentId, permissions, kycStatus }
companies: { headId, commissionSlabs }
virtual_portfolio: { userId, holdings, transactions }
virtual_sips: { userId, sellerId, fundId, amount, schedule }
commissions: { sellerId, adminId, amount, period }
funds: { symbol, nav, performance } // Updated daily
transactions: { type: 'virtual', userId, sellerId }
```

### **Authentication**
- JWT middleware for role protection
- Route guards: `/admin/*`, `/seller/*`, `/customer/*`
- Session-based permissions

### **API Endpoints** (App Router)
```
# Auth
POST /api/auth/login
POST /api/auth/register

# Company Head
GET /api/company/dashboard
POST /api/company/admins
PUT /api/company/commissions

# Admin
GET /api/admin/team
POST /api/admin/sellers
GET /api/admin/commissions

# Seller
POST /api/seller/customers
POST /api/seller/virtual-sip
GET /api/seller/commissions

# Customer
GET /api/customer/portfolio
POST /api/customer/virtual-sip
GET /api/customer/watchlist
```

### **Virtual SIP System**
- **Creation**: Customer selects fund, amount, frequency
- **Processing**: Daily cron job calculates units using real NAV
- **Tracking**: Performance updates, virtual returns calculation
- **Commissions**: Auto-calculated based on company slabs
- **No real money**: Pure simulation with real market data

### **Commission Tracking**
- **Calculation**: Based on virtual SIP amounts & company slabs
- **Real-time**: Updates when SIPs are created/modified
- **Dashboards**: Role-specific commission views
- **Payout simulation**: Monthly commission statements

### **Daily Data Updates**
- Cron job at 7 AM fetches real NAV data
- Updates `funds` collection
- Recalculates virtual portfolio values
- Updates commission calculations

---

## **MVP Implementation Phases**

### **Phase 1: Core Setup**
1. Next.js App Router setup with MongoDB
2. JWT authentication & role middleware
3. Basic user registration/login
4. Fund data fetching & daily cron job

### **Phase 2: Role Features**
1. Company Head dashboard & admin management
2. Seller customer management & virtual SIP creation
3. Customer portfolio & watchlist
4. Basic commission calculation

### **Phase 3: Analytics & Tracking**
1. Role-specific dashboards with charts
2. Commission tracking & reports
3. Virtual SIP performance tracking
4. Export functionality

### **Phase 4: Polish & Stretch**
1. Admin seller management
2. Aadhaar e-KYC integration (stretch)
3. UI improvements & testing
4. Documentation

---

## **Security & Compliance**
- **Data Isolation**: Role-based MongoDB queries
- **Virtual Only**: No real payment gateways
- **KYC**: Basic document upload (stretch: Aadhaar API)
- **Audit Logs**: Track all virtual transactions
- **Rate Limiting**: API protection
- **Encryption**: Sensitive data in MongoDB

## **UI Requirements**
- **Responsive**: Mobile-first with Tailwind CSS
- **Role-based**: Dynamic navigation menus
- **Charts**: Recharts for performance visualization
- **Real-time**: NAV updates via Server Components
- **Tables**: Data tables with filtering/sorting

## **Success Metrics**
- Virtual SIP creation working end-to-end
- Commission calculations accurate
- Role isolation maintained
- Daily NAV updates reliable
- <2s page load times
- 99% uptime for core features
